# 项目功能
- 数据源管理模块 → 集成数据源连接信息，提供数据源连接测试，数据查询，查询日志；
- 元数据管理模块 → 基于已纳管的数据源，自动采集库、表、字段信息（依赖数据源的连接信息）；
- 数据资产目录模块 → 基于元数据，构建资产分类、标签、画像（依赖元数据）；
- 数据质量模块 → 针对资产目录中的表，配置质量规则、定时检测（依赖资产目录）；
- 数据血缘模块 → 基于元数据和 ETL 日志，解析表 / 字段级血缘（依赖元数据）；
- 数据权限模块 → 细化到表 / 字段级的权限控制（复用系统管理 + 数据源的权限基础）。




# 数据源管理模块
## 数据查询
*目标：前端数据查询-支持新增查询页，每个查询页面相互独立，查询页面的功能*
代码位置：
- 前端：frontend/src/views/datasource/query/
- 后端：backend/apps/datasource

*需求描述*
1. 用户点击数据查询菜单进入数据查询页面，查询页面以tab的形式展示，每个tab对应一个查询页面，最后一个tab为新增查询按钮。
2. 用户点击新增查询按钮，在当前页面新增一个tab，并切换到该tab，用户可以重新选择数据源，编辑查询语句，点击执行查询，查询结果展示在当前tab页面。

*输出要求*
对应前端代码位置
- 进入查询页面(frontend/src/views/datasource/query/index.vue)
- index.vue页面中以tab形式展示多个查询页面，最后一个tab为新增查询按钮
- 查询页面代码拆分：
    queryView.vue: 选择数据源，编辑查询语句，执行查询， 分页查询下一页数据，查看上一页结果
    queryResult.vue：显示查询结果, 查询结果使用el-table组件展示，但是需要根据数据内容调整列宽度，参考方法： frontend\src\utils\index.js 中的 calculateColumnWidth 方法
- 后端查询接口方法为： DataSourceViewSet.query_by_id

*统一规范：*
- 适配现有的代码风格


## 数据查询支持django模板语法
*目标：在数据查询语句中支持django模板语法，用户可以在查询语句中使用django模板语法，例如：{{ var }}，{% if %}，{% for %}等*
*实现：*
- 前端：在查询语句输入框中添加django模板语法提示，用户可以选择是否添加模板参数，通过新增一个模板参数按钮，弹窗输入模板参数
- 后端：在执行查询语句时，使用django的模板引擎渲染查询语句，替换其中的变量和表达式。
    - 前端传递查询语句和参数到后端时，需要将查询语句和参数封装在一个字典中，例如：{'sql': 'select * from {{ table }}', 'params': {'table': 'user'}}
    - 后端在执行查询语句前，需要使用django的模板引擎渲染查询语句，替换其中的变量和表达式，例如：render_string('select * from {{ table }}', {'table': 'user'})
    - 后端执行查询语句后，将查询结果返回给前端。

*注意*
在后端DataSourceViewSet.query_by_id方法中使用了params参数来传递参数给查询执行器，但是这是不需要的，请修改代码，使该参数来接收前端传递的模板参数

*统一规范：*
- 适配现有的代码风格，使用一致的命名约定，使用一致的代码风格。

## 数据查询编辑框优化
*目标：优化数据查询语句编辑框，支持多行输入，添加语法高亮，自动补全等功能*
代码位置：
- 前端：frontend/src/views/datasource/query/queryView.vue

*需求*
- 数据查询语句编辑框支持多行输入，用户可以在编辑框中输入多行查询语句。
- 数据查询语句编辑框添加语法高亮，用户可以在编辑框中查看查询语句的语法高亮效果。
- 数据查询语句编辑框添加自动补全功能，用户可以在编辑框中输入查询语句时，根据已输入的内容自动补全查询语句。

*要求*
- 编写可复用的编辑框组件，支持多种语法， 组件位置放置在 frontend/src/components/目录下
- 参考components目录下的结构

*统一规范：*
- 适配现有的代码风格，使用一致的命名约定，使用一致的代码风格。

*继续优化CodeEditor组件*
- 使用vue3-ace-editor组件替换当前的CodeEditor组件，该组件支持vue3，并且有更好的性能和功能。



## 数据查询日志记录
*目标：记录用户在数据查询页面执行的查询语句，包括查询时间，查询语句，查询用户名， 查询结果状态（成功或失败），查询耗时等信息*
代码位置：
- 后端：backend/apps/datasource/models.py
- 数据库表：datasource_query_log
- 前端：frontend/src/views/datasource/query/queryLog.vue

*需求*
- 用户在数据查询页面执行查询后，查询日志记录在数据库中，包括查询时间，查询语句，查询用户名， 查询结果状态（成功或失败），查询耗时等信息。
- 用户可以在查询日志页面查看所有查询记录，包括查询时间，查询语句，查询用户名， 查询结果状态（成功或失败），查询耗时等信息。

*统一规范：*
- 适配现有的代码风格，使用一致的命名约定，使用一致的代码风格。

*更新功能*
- 查询日志添加错误信息

# 元数据管理模块

## 数据总览
*需求*
- 用户可以在数据总览页面查看已纳入的数据表
- 用户点击对应的数据表，可以查看到该表的字段信息。
- 用户可以筛选的字段：数据表名，数据库名，创建时间，修改时间

代码位置：
- 后端：backend/apps/datameta
- 前端：frontend/src/views/datameta/index.vue

主要类：
- MetaTableViewSet：元数据表管理视图类。
- MetaColumnViewSet：元数据字段管理视图类。

*统一规范：*
- 适配现有的代码风格
- 参考后端开发规范（backend/开发规范.md）

### 数据总览功能更新
- 源数据表的增删改操作，用户可以在数据总览页面对源数据表进行增删改操作。


### 元数据管理页面功能更新
*需求：扩充采集的元数据信息*

*功能修改*
- 采集的元数据表信息包括表名，表描述，原始数据库，创建同步时间，修改同步时间，采集人（用户名），更新者（用户名）
- 采集的元数据字段信息包括字段名，字段描述，字段类型，是否主键，是否非空，默认值
- 源数据表查询结果分页展示

*代码位置*
- 前端：frontend/src/views/datameta/index.vue
- 后端：backend/apps/datameta/views.py

*注意*
- 不要编写重复功能的方法，先考虑是否有已有的方法可以实现该功能，再编写新的方法。

*统一规范：*
- 适配现有的代码风格
- 参考后端开发规范（backend/开发规范.md）



## 原始数据源业务数据查看
*目标：用户可以查看选择数据源中所有的业务表*

*需求*
- 新增一个业务数据查看页面，用户可以在该页面查看选择数据源中所有的业务表。
- 点击业务业务数据表可以查看该表的字段信息
- 在每个业务表信息中添加一个采集按钮，点击按钮可以触发所选业务表的元数据采集

*统一规范：*
- 参考前端代码目录结构，将业务数据查看页面放置在frontend/src/views/datameta/businessData目录下
- 后端代码考虑代码的复用性，将业务数据查看相关的代码放置在backend/apps/datameta/views.py文件中

### 业务数据查看页面功能更新
*需求：支持筛选业务表名*

*功能描述*
- 用户在选择数据源后，业务数据查看页面会显示该数据源下所有的业务表（后端返回所有的数据表信息）。
- 用户可以在筛选框中输入表名，筛选出包含该表名的业务表(前端实现筛选)。
- 尽可能多的显示业务数据表的信息，例如：表名称，数据库名称，表描述，表创建时间，表修改时间，表创建时间

*代码位置*
- 前端：frontend/src/views/datameta/businessData/index.vue
- 后端：backend/apps/datameta/views.py
- 在数据查询执行器中添加一个方法list_tables_info，用来获取数据源下所有数据表信息，该方法需要返回数据表信息，例如：表名称，数据库名称，表描述，表创建时间，表修改时间，表创建时间

*统一规范：*
- 适配现有的代码风格

### 业务数据查看功能更新2.0
*背景*
  在多租户场景下，在每个数据源实例下，同时又多个数据库实例，例如：mysql实例下有多个数据库实例，每个数据库实例下有多个数据表， 每一个数据库代表一个租户的数据库，租户之间的数据是隔离的。

*需求描述*
- 选择对应的数据源实例后，根据所选数据源的不同数据源类型，会有不同的逻辑
    如果是mysql,则还会有数据库的选择框来筛选对应的数据库，选择完数据库后才可以获取数据表信息；
    如果是postgresql,则直接获取所有数据表信息

*代码实现*
- 后端代码位置：backend/apps/dbutils/
- 添加数据库查询方法：get_databases(self, ds)， 对于没有数据概念的数据源，该方法返回None
- 后端数据库查询接口如果返回的数据库信息为None，则前端不显示数据库选择框，否则显示数据库选择框
- 前端代码位置：frontend/src/views/datameta/businessData/index.vue

### 业务数据查看功能更新3.0
*需求*
  在数据查询执行器中的get_table_schema方法中，返回的字段信息中，补充字段的描述信息


## 数据访问执行器功能更新
*需求*
  在数据查询执行器中的get_table_schema方法中，返回的字段信息中，补充字段的序号（从1开始）

*要求*
- 序号字段名为：order
- 前后端都需要根据order字段进行排序